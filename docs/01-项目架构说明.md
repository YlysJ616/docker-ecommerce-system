# 项目架构说明

## 系统架构

本项目采用经典的三层架构设计，完全基于 Docker 容器化部署。

```
┌─────────────────────────────────────────────────────────┐
│                      用户浏览器                          │
└─────────────────────────────────────────────────────────┘
                          │
                          ↓
┌─────────────────────────────────────────────────────────┐
│                  前端服务 (Nginx)                        │
│                  端口: 80                                │
│  - 静态页面托管                                          │
│  - API 请求代理                                          │
└─────────────────────────────────────────────────────────┘
                          │
                          ↓
┌─────────────────────────────────────────────────────────┐
│              后端服务 (Spring Boot)                      │
│                  端口: 8080                              │
│  - RESTful API                                          │
│  - 业务逻辑处理                                          │
│  - 数据访问层                                            │
└─────────────────────────────────────────────────────────┘
                          │
                          ↓
┌─────────────────────────────────────────────────────────┐
│                数据库服务 (MySQL)                        │
│                  端口: 3306                              │
│  - 数据持久化                                            │
│  - 事务管理                                              │
└─────────────────────────────────────────────────────────┘
```

## 技术栈

### 前端
- **Nginx 1.25-alpine**: 轻量级 Web 服务器
- **HTML/CSS/JavaScript**: 原生前端技术
- **现代化 UI 设计**: 简约高端风格

### 后端
- **Spring Boot 3.2.0**: Java 企业级框架
- **Spring Data JPA**: ORM 框架
- **MySQL Connector**: 数据库驱动
- **Spring Boot Actuator**: 健康检查

### 数据库
- **MySQL 8.0**: 关系型数据库
- **Docker Volume**: 数据持久化

### 容器化
- **Docker**: 容器引擎
- **Docker Compose**: 容器编排

## 网络架构

### 自定义网络
- 网络名称: `ecommerce-network`
- 网络类型: `bridge`
- 网络驱动: `bridge`

### 服务通信
- 前端 → 后端: `http://backend:8080`
- 后端 → 数据库: `jdbc:mysql://db:3306/ecommerce`

### 端口映射
- 前端: `80:80`
- 后端: `8080:8080`
- 数据库: `3307:3306` (避免与本地 MySQL 冲突)

## 数据流

1. **用户请求** → 浏览器访问 `http://localhost`
2. **前端处理** → Nginx 返回静态页面
3. **API 调用** → JavaScript 发起 `/api/products` 请求
4. **请求代理** → Nginx 代理到 `http://backend:8080`
5. **业务处理** → Spring Boot 处理业务逻辑
6. **数据查询** → JPA 查询 MySQL 数据库
7. **响应返回** → 数据层层返回到前端
8. **页面渲染** → JavaScript 渲染商品列表

## 容器依赖关系

```yaml
db (数据库)
  ↓
backend (后端) - depends_on: db (healthy)
  ↓
frontend (前端) - depends_on: backend
```

## 健康检查机制

### 数据库健康检查
```bash
mysqladmin ping -h localhost -u root -proot123
```

### 后端健康检查
```bash
curl -f http://localhost:8080/actuator/health
```

### 前端健康检查
```bash
curl -f http://localhost/health.html
```

## 数据持久化

### Docker Volume
- 卷名: `db_data`
- 挂载点: `/var/lib/mysql`
- 驱动: `local`

### 初始化脚本
- 脚本路径: `./database/init-chinese.sql`
- 挂载点: `/docker-entrypoint-initdb.d/init.sql`
- 执行时机: 容器首次启动

## 安全设计

1. **非 root 用户**: 后端容器使用 `spring` 用户运行
2. **环境变量**: 敏感信息通过环境变量传递
3. **网络隔离**: 容器间通过自定义网络通信
4. **端口映射**: 数据库不直接暴露标准端口

## 扩展性设计

1. **水平扩展**: 可通过 Docker Compose scale 扩展后端实例
2. **负载均衡**: 可在前端添加 Nginx 负载均衡
3. **数据库集群**: 可配置 MySQL 主从复制
4. **缓存层**: 可添加 Redis 缓存服务

## 监控与日志

### 日志查看
```bash
# 查看所有服务日志
docker-compose logs

# 查看特定服务日志
docker-compose logs frontend
docker-compose logs backend
docker-compose logs db
```

### 健康状态
```bash
# 查看容器状态
docker-compose ps

# 查看后端健康状态
curl http://localhost:8080/actuator/health
```
